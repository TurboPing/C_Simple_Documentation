<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mainloop: mainloop_good.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>mainloop_good.c File Reference</h1>Example for "good" main loop.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;errno.h&gt;</code><br>
<code>#include &lt;sys/time.h&gt;</code><br>
<code>#include &lt;sys/socket.h&gt;</code><br>
<code>#include &lt;signal.h&gt;</code><br>
<code>#include &lt;fcntl.h&gt;</code><br>

<p>
<a href="mainloop__good_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="structecho__client__t.html">echo_client_t</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">echo client specific state  <a href="structecho__client__t.html#_details">More...</a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="structchargen__client__t.html">chargen_client_t</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">chargen client specific state  <a href="structchargen__client__t.html#_details">More...</a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="structclient__t.html">client_t</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">client state  <a href="structclient__t.html#_details">More...</a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="structalarm__t.html">alarm_t</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">alarm handler state  <a href="structalarm__t.html#_details">More...</a><br><br></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a0">PORT_ECHO</a>&nbsp;&nbsp;&nbsp;5005</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">tcp port to listen for echo clients  <a href="#a0"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a1">PORT_CHARGEN</a>&nbsp;&nbsp;&nbsp;5006</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">tcp port to listen for chargen clients  <a href="#a1"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a2">HEARTBEAT_INTERVAL</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">heartbeat interval (in seconds)  <a href="#a2"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a3">SLOWHEARTBEAT_INTERVAL</a>&nbsp;&nbsp;&nbsp;15</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">slow heartbeat interval (in seconds)  <a href="#a3"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a4">BUFSIZE</a>&nbsp;&nbsp;&nbsp;16</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">buffer size for echo client  <a href="#a4"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a5">MAXCLIENTS</a>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">maximum number of clients  <a href="#a5"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a6">MAXALARMS</a>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">maximum number of different alarms  <a href="#a6"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a7">MSG_HEARTBEAT</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a8">MSG_SLOWHEARTBEAT</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a9">MSG_MAINLOOP</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a10">MSG_ACCEPT</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a11">MSG_TOOMANY</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a12">MSG_CLOSE</a>&nbsp;&nbsp;&nbsp;5</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a13">MSG_READ</a>&nbsp;&nbsp;&nbsp;6</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a14">MSG_WRITE</a>&nbsp;&nbsp;&nbsp;7</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a15">MSG_FULL</a>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a16">MSG_EMPTY</a>&nbsp;&nbsp;&nbsp;9</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a17">MIN</a>(a, b)&nbsp;&nbsp;&nbsp;((a)&lt;(b)?(a):(b))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a18">MAX</a>(a, b)&nbsp;&nbsp;&nbsp;((a)&gt;(b)?(a):(b))</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef void(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a20">eventhandler_t</a> )(int i)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">event handler  <a href="#a20"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef void(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a21">alarmhandler_t</a> )(void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">alarm handler  <a href="#a21"></a><br><br></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a26">message</a> (int msg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">print message describing current activity  <a href="#a26"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a27">blocksigpipe</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">block SIGPIPE  <a href="#a27"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a28">initalarms</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">install non-resetting signal handler for alarms  <a href="#a28"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a29">addalarm</a> (<a class="el" href="mainloop__good_8c.html#a21">alarmhandler_t</a> handler, long interval)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">add new alarm  <a href="#a29"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a30">checkalarms</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">check for pending alarms and execute alarm handlers  <a href="#a30"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a31">alarmhandler</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">signal handler for alarms  <a href="#a31"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a32">heartbeat</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">print heartbeat message  <a href="#a32"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a33">slowheartbeat</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">print "slowheartbeat" message  <a href="#a33"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a34">listensocket</a> (int port)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">return tcp socket listening on port specified  <a href="#a34"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a35">setnonblock</a> (int fd)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">set a file descriptor to be nonblocking  <a href="#a35"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a36">initclients</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">initialize client state array  <a href="#a36"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a37">addclient</a> (int fd, <a class="el" href="mainloop__good_8c.html#a20">eventhandler_t</a> read, <a class="el" href="mainloop__good_8c.html#a20">eventhandler_t</a> write, <a class="el" href="mainloop__good_8c.html#a20">eventhandler_t</a> except)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">add new client  <a href="#a37"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a38">delclient</a> (int i)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">delete client  <a href="#a38"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a39">mainloop</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">execute one iteration of THE mainloop  <a href="#a39"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a40">closeclient</a> (int i)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">close and delete client session  <a href="#a40"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a41">acceptecho</a> (int i)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">accept connection and set up new session for "echo" service  <a href="#a41"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a42">readecho</a> (int i)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">read data from echo client  <a href="#a42"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a43">writeecho</a> (int i)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">write data to an echo client  <a href="#a43"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a44">flowecho</a> (int i)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">do "flow" control for echo  <a href="#a44"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a45">acceptchargen</a> (int i)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">accept connection and set up new session for "chargen" service  <a href="#a45"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a46">writechargen</a> (int i)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">write data to an chargen client  <a href="#a46"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a47">main</a> ()</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>char&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a19">chargen_buf</a> [] = "0123456789abcdefghijklmnopqrstuv"</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">characters to return in chargen service  <a href="#a19"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>unsigned long&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a22">npollfd</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">number of file descriptors to check  <a href="#a22"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structclient__t.html">client_t</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a23">clients</a> [MAXCLIENTS]</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">array of client states  <a href="#a23"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>pollfd&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a24">pollfds</a> [MAXCLIENTS]</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">pollfds for poll()  <a href="#a24"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structalarm__t.html">alarm_t</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__good_8c.html#a25">alarms</a> [MAXALARMS]</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">alarms  <a href="#a25"></a><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Example for "good" main loop. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>Rico Pajarola</dd></dl>
This example does essentially what glib would do: events are abstracted using callbacks making the mainloop generic (but not as generic as glib). Even though it is easy to add a new input or event source, the whole mechanism is still very much tied to the structure of this program).
<p>
Definition in file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="a4" doxytag="mainloop_good.c::BUFSIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BUFSIZE&nbsp;&nbsp;&nbsp;16          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
buffer size for echo client 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00037">37</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="mainloop_good.c::HEARTBEAT_INTERVAL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define HEARTBEAT_INTERVAL&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
heartbeat interval (in seconds) 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00031">31</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="mainloop_good.c::MAX" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>b&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((a)&gt;(b)?(a):(b))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00057">57</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="mainloop_good.c::MAXALARMS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAXALARMS&nbsp;&nbsp;&nbsp;8          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
maximum number of different alarms 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00043">43</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00263">addalarm()</a>, <a class="el" href="mainloop__good_8c-source.html#l00307">alarmhandler()</a>, <a class="el" href="mainloop__good_8c-source.html#l00285">checkalarms()</a>, and <a class="el" href="mainloop__good_8c-source.html#l00235">initalarms()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="mainloop_good.c::MAXCLIENTS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAXCLIENTS&nbsp;&nbsp;&nbsp;8          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
maximum number of clients 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00040">40</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="mainloop_good.c::MIN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MIN          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>b&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((a)&lt;(b)?(a):(b))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00056">56</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="mainloop_good.c::MSG_ACCEPT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_ACCEPT&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00048">48</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="mainloop_good.c::MSG_CLOSE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_CLOSE&nbsp;&nbsp;&nbsp;5          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00050">50</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="mainloop_good.c::MSG_EMPTY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_EMPTY&nbsp;&nbsp;&nbsp;9          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00054">54</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="mainloop_good.c::MSG_FULL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_FULL&nbsp;&nbsp;&nbsp;8          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00053">53</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="mainloop_good.c::MSG_HEARTBEAT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_HEARTBEAT&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00045">45</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="mainloop_good.c::MSG_MAINLOOP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_MAINLOOP&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00047">47</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="mainloop_good.c::MSG_READ" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_READ&nbsp;&nbsp;&nbsp;6          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00051">51</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="mainloop_good.c::MSG_SLOWHEARTBEAT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_SLOWHEARTBEAT&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00046">46</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="mainloop_good.c::MSG_TOOMANY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_TOOMANY&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00049">49</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="mainloop_good.c::MSG_WRITE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_WRITE&nbsp;&nbsp;&nbsp;7          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00052">52</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="mainloop_good.c::PORT_CHARGEN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PORT_CHARGEN&nbsp;&nbsp;&nbsp;5006          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
tcp port to listen for chargen clients 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00028">28</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="mainloop_good.c::PORT_ECHO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PORT_ECHO&nbsp;&nbsp;&nbsp;5005          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
tcp port to listen for echo clients 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00025">25</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="mainloop_good.c::SLOWHEARTBEAT_INTERVAL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SLOWHEARTBEAT_INTERVAL&nbsp;&nbsp;&nbsp;15          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
slow heartbeat interval (in seconds) 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00034">34</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a21" doxytag="mainloop_good.c::alarmhandler_t" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef void(* <a class="el" href="mainloop__good_8c.html#a21">alarmhandler_t</a>)(void)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
alarm handler 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00106">106</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="mainloop_good.c::eventhandler_t" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef void(* <a class="el" href="mainloop__good_8c.html#a20">eventhandler_t</a>)(int i)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
event handler 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>i</em>&nbsp;</td><td>index into clients </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00084">84</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a45" doxytag="mainloop_good.c::acceptchargen" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void acceptchargen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>i</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
accept connection and set up new session for "chargen" service 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>i</em>&nbsp;</td><td>index into pollfds/clients array for server descriptor </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00680">680</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00437">addclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00132">clients</a>, <a class="el" href="mainloop__good_8c-source.html#l00666">closeclient()</a>, and <a class="el" href="mainloop__good_8c-source.html#l00706">writechargen()</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00734">main()</a>.
<p>
<pre class="fragment"><div>00681 {
00682     <span class="keywordtype">int</span>             fd;
00683     socklen_t       t;
00684     <span class="keyword">struct </span>sockaddr_in sain;
00685 
00686     t = <span class="keyword">sizeof</span>(sain);
00687     <span class="keywordflow">if</span> ((fd = accept(clients[i].fd, (<span class="keywordtype">void</span> *) &amp;sain, &amp;t)) == -1) {
00688         <span class="keywordflow">if</span> (errno == EWOULDBLOCK) {
00689             <span class="keywordflow">return</span>;
00690         }
00691         perror(<span class="stringliteral">"accept(CHARGEN)"</span>);
00692         exit(EXIT_FAILURE);
00693     }
00694     <a class="code" href="mainloop__good_8c.html#a37">addclient</a>(fd, NULL, &amp;writechargen, &amp;closeclient);
00695 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="mainloop_good.c::acceptecho" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void acceptecho           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>i</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
accept connection and set up new session for "echo" service 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>i</em>&nbsp;</td><td>index into pollfds/clients array for server descriptor </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00524">524</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00437">addclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00132">clients</a>, <a class="el" href="mainloop__good_8c-source.html#l00666">closeclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00050">MSG_ACCEPT</a>, <a class="el" href="mainloop__good_8c-source.html#l00551">readecho()</a>, and <a class="el" href="mainloop__good_8c-source.html#l00598">writeecho()</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00734">main()</a>.
<p>
<pre class="fragment"><div>00525 {
00526     <span class="keywordtype">int</span>             fd;
00527     socklen_t       t;
00528     <span class="keyword">struct </span>sockaddr_in sain;
00529 
00530     t = <span class="keyword">sizeof</span>(sain);
00531     <span class="keywordflow">if</span> ((fd = accept(clients[i].fd, (<span class="keywordtype">void</span> *) &amp;sain, &amp;t)) == -1) {
00532         <span class="keywordflow">if</span> (errno == EWOULDBLOCK) {
00533             <span class="keywordflow">return</span>;
00534         }
00535         perror(<span class="stringliteral">"accept(ECHO)"</span>);
00536         exit(EXIT_FAILURE);
00537     }
00538     <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_ACCEPT);
00539     <a class="code" href="mainloop__good_8c.html#a37">addclient</a>(fd, &amp;readecho, &amp;writeecho, &amp;closeclient);
00540 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="mainloop_good.c::addalarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void addalarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="mainloop__good_8c.html#a21">alarmhandler_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>handler</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>interval</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
add new alarm 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>handler</em>&nbsp;</td><td>alarm handler procedure </td></tr>
    <tr><td></td><td valign=top><em>interval</em>&nbsp;</td><td>interval in seconds</td></tr>
  </table>
</dl>
<p>
<dl compact><dt><b><a class="el" href="bug.html#_bug000001">Bug:</a></b></dt><dd>no error handling, if there are no more error handler slots, the new alarm is ignored... </dd></dl>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00263">263</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00307">alarmhandler()</a>, <a class="el" href="mainloop__good_8c-source.html#l00134">alarms</a>, <a class="el" href="mainloop__good_8c-source.html#l00118">alarm_t::flag</a>, <a class="el" href="mainloop__good_8c-source.html#l00115">alarm_t::handler</a>, <a class="el" href="mainloop__good_8c-source.html#l00116">alarm_t::interval</a>, <a class="el" href="mainloop__good_8c-source.html#l00043">MAXALARMS</a>, and <a class="el" href="mainloop__good_8c-source.html#l00117">alarm_t::nexttime</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00734">main()</a>.
<p>
<pre class="fragment"><div>00264 {
00265     <span class="keyword">struct </span>timeval  now;
00266     <span class="keywordtype">int</span>             i;
00267 
00268     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="mainloop__good_8c.html#a6">MAXALARMS</a>; i++) {
00269         <span class="keywordflow">if</span> (<a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o0">handler</a> == NULL) {
00270             gettimeofday(&amp;now, NULL);
00271             <a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o0">handler</a> = handler;
00272             <a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o1">interval</a> = interval;
00273             <a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o2">nexttime</a> = now.tv_sec + interval;
00274             <a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o3">flag</a> = 0;
00275             <a class="code" href="mainloop__good_8c.html#a31">alarmhandler</a>();
00276             <span class="keywordflow">return</span>;
00277         }
00278     }
00279 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="mainloop_good.c::addclient" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void addclient           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="mainloop__good_8c.html#a20">eventhandler_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>read</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="mainloop__good_8c.html#a20">eventhandler_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>write</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="mainloop__good_8c.html#a20">eventhandler_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>except</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
add new client 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>fd</em>&nbsp;</td><td>file descriptor asociated with this client </td></tr>
    <tr><td></td><td valign=top><em>read</em>&nbsp;</td><td>handler called if socket is readable </td></tr>
    <tr><td></td><td valign=top><em>write</em>&nbsp;</td><td>handler called if socket is writable </td></tr>
    <tr><td></td><td valign=top><em>except</em>&nbsp;</td><td>handler called on exceptions (HUP, close etc). </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00437">437</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00132">clients</a>, <a class="el" href="mainloop__good_8c-source.html#l00096">client_t::except</a>, <a class="el" href="mainloop__good_8c-source.html#l00093">client_t::fd</a>, <a class="el" href="mainloop__bad_8c-source.html#l00045">MAXCLIENTS</a>, <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00051">MSG_TOOMANY</a>, <a class="el" href="mainloop__good_8c-source.html#l00131">npollfd</a>, <a class="el" href="mainloop__good_8c-source.html#l00133">pollfds</a>, <a class="el" href="mainloop__good_8c-source.html#l00094">client_t::read</a>, and <a class="el" href="mainloop__good_8c-source.html#l00095">client_t::write</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00680">acceptchargen()</a>, <a class="el" href="mainloop__good_8c-source.html#l00524">acceptecho()</a>, and <a class="el" href="mainloop__good_8c-source.html#l00734">main()</a>.
<p>
<pre class="fragment"><div>00439 {
00440     <span class="keywordflow">if</span> (<a class="code" href="mainloop__good_8c.html#a22">npollfd</a> &gt;= (<a class="code" href="mainloop__bad_8c.html#a5">MAXCLIENTS</a> - 1)) {
00441         close(fd);
00442         <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_TOOMANY);
00443         <span class="keywordflow">return</span>;
00444     }
00445     <a class="code" href="mainloop__good_8c.html#a23">clients</a>[<a class="code" href="mainloop__good_8c.html#a22">npollfd</a>].<a class="code" href="structclient__t.html#o0">fd</a> = fd;
00446     <a class="code" href="mainloop__good_8c.html#a23">clients</a>[<a class="code" href="mainloop__good_8c.html#a22">npollfd</a>].<a class="code" href="structclient__t.html#o1">read</a> = read;
00447     <a class="code" href="mainloop__good_8c.html#a23">clients</a>[<a class="code" href="mainloop__good_8c.html#a22">npollfd</a>].<a class="code" href="structclient__t.html#o2">write</a> = write;
00448     <a class="code" href="mainloop__good_8c.html#a23">clients</a>[<a class="code" href="mainloop__good_8c.html#a22">npollfd</a>].<a class="code" href="structclient__t.html#o3">except</a> = except;
00449     <a class="code" href="mainloop__good_8c.html#a24">pollfds</a>[<a class="code" href="mainloop__good_8c.html#a22">npollfd</a>].fd = fd;
00450     <a class="code" href="mainloop__good_8c.html#a24">pollfds</a>[<a class="code" href="mainloop__good_8c.html#a22">npollfd</a>].events = 0;
00451     <span class="keywordflow">if</span> (read) {
00452         <a class="code" href="mainloop__good_8c.html#a24">pollfds</a>[<a class="code" href="mainloop__good_8c.html#a22">npollfd</a>].events |= POLLIN;
00453     }
00454     <span class="keywordflow">if</span> (write) {
00455         <a class="code" href="mainloop__good_8c.html#a24">pollfds</a>[<a class="code" href="mainloop__good_8c.html#a22">npollfd</a>].events |= POLLOUT;
00456     }
00457     <a class="code" href="mainloop__good_8c.html#a22">npollfd</a>++;
00458 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="mainloop_good.c::alarmhandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void alarmhandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
signal handler for alarms 
<p>
mark expired alarms for execution and set new alarm timer.<p>
the resolution of the alarm timer is one second, no attempt is made to get timing beyond this one second resolution (any sub-second timing information is discarded). 
<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00307">307</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00134">alarms</a>, <a class="el" href="mainloop__good_8c-source.html#l00118">alarm_t::flag</a>, <a class="el" href="mainloop__good_8c-source.html#l00115">alarm_t::handler</a>, <a class="el" href="mainloop__good_8c-source.html#l00116">alarm_t::interval</a>, <a class="el" href="mainloop__bad_8c-source.html#l00059">MAX</a>, <a class="el" href="mainloop__good_8c-source.html#l00043">MAXALARMS</a>, <a class="el" href="mainloop__bad_8c-source.html#l00058">MIN</a>, and <a class="el" href="mainloop__good_8c-source.html#l00117">alarm_t::nexttime</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00263">addalarm()</a>, and <a class="el" href="mainloop__good_8c-source.html#l00235">initalarms()</a>.
<p>
<pre class="fragment"><div>00308 {
00309     <span class="keyword">struct </span>timeval  now;
00310     <span class="keywordtype">long</span>            nextalarm;
00311     <span class="keywordtype">int</span>             i;
00312 
00313     gettimeofday(&amp;now, NULL);
00314 
00315     nextalarm = 65536;
00316     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="mainloop__good_8c.html#a6">MAXALARMS</a>; i++) {
00317         <span class="keywordflow">if</span> (<a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o0">handler</a> != NULL) {
00318             <span class="keywordflow">if</span> (<a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o2">nexttime</a> &lt;= now.tv_sec) {
00319                 <a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o3">flag</a> = 1;
00320                 <a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o2">nexttime</a> += <a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o1">interval</a>;
00321             }
00322             nextalarm =
00323                 <a class="code" href="mainloop__bad_8c.html#a16">MIN</a>(nextalarm,
00324                     <a class="code" href="mainloop__bad_8c.html#a17">MAX</a>(1,
00325                         (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) alarms[i].nexttime - now.tv_sec));
00326         }
00327     }
00328     alarm((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) nextalarm);
00329 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="mainloop_good.c::blocksigpipe" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void blocksigpipe           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
block SIGPIPE 
<p>
Trying to write to a socket when the other end has already closed the connection results in SIGPIPE. Not usefull in this context. 
<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00214">214</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
<pre class="fragment"><div>00215 {
00216     <span class="keyword">struct </span>sigaction act;
00217 
00218     act.sa_handler = SIG_IGN;
00219     sigemptyset(&amp;act.sa_mask);
00220     act.sa_flags = SA_RESTART;
00221     <span class="keywordflow">if</span> (sigaction(SIGPIPE, &amp;act, NULL) == -1) {
00222         perror(<span class="stringliteral">"sigaction(SIGPIPE, &lt;ignore&gt;)"</span>);
00223         exit(EXIT_FAILURE);
00224     }
00225 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="mainloop_good.c::checkalarms" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void checkalarms           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
check for pending alarms and execute alarm handlers 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00285">285</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00134">alarms</a>, <a class="el" href="mainloop__good_8c-source.html#l00118">alarm_t::flag</a>, <a class="el" href="mainloop__good_8c-source.html#l00115">alarm_t::handler</a>, and <a class="el" href="mainloop__good_8c-source.html#l00043">MAXALARMS</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00481">mainloop()</a>.
<p>
<pre class="fragment"><div>00286 {
00287     <span class="keywordtype">int</span>             i;
00288 
00289     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="mainloop__good_8c.html#a6">MAXALARMS</a>; i++) {
00290         <span class="keywordflow">if</span> (<a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o3">flag</a>) {
00291             (*<a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o0">handler</a>) ();
00292             <a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o3">flag</a> = 0;
00293         }
00294     }
00295 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="mainloop_good.c::closeclient" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void closeclient           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>i</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
close and delete client session 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>i</em>&nbsp;</td><td>index into pollfds/clients array </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00666">666</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00132">clients</a>, <a class="el" href="mainloop__good_8c-source.html#l00466">delclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00093">client_t::fd</a>, <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00052">MSG_CLOSE</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00680">acceptchargen()</a>, <a class="el" href="mainloop__good_8c-source.html#l00524">acceptecho()</a>, <a class="el" href="mainloop__good_8c-source.html#l00551">readecho()</a>, <a class="el" href="mainloop__good_8c-source.html#l00706">writechargen()</a>, and <a class="el" href="mainloop__good_8c-source.html#l00598">writeecho()</a>.
<p>
<pre class="fragment"><div>00667 {
00668     <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_CLOSE);
00669     close(clients[i].fd);
00670     <a class="code" href="mainloop__good_8c.html#a38">delclient</a>(i);
00671     <a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o0">fd</a> = -1;
00672 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="mainloop_good.c::delclient" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void delclient           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>i</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
delete client 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>i</em>&nbsp;</td><td>index into pollfds/clients array </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00466">466</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00132">clients</a>, <a class="el" href="mainloop__good_8c-source.html#l00093">client_t::fd</a>, <a class="el" href="mainloop__good_8c-source.html#l00131">npollfd</a>, and <a class="el" href="mainloop__good_8c-source.html#l00133">pollfds</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00666">closeclient()</a>.
<p>
<pre class="fragment"><div>00467 {
00468     <a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o0">fd</a> = -1;
00469     <span class="keywordflow">if</span> (i != <a class="code" href="mainloop__good_8c.html#a22">npollfd</a>) {
00470         <span class="comment">/* just copy the whole thing including the buffer... */</span>
00471         memcpy(&amp;clients[i], &amp;clients[npollfd], <span class="keyword">sizeof</span>(clients[i]));
00472         <a class="code" href="mainloop__good_8c.html#a24">pollfds</a>[i] = <a class="code" href="mainloop__good_8c.html#a24">pollfds</a>[<a class="code" href="mainloop__good_8c.html#a22">npollfd</a>];
00473         <a class="code" href="mainloop__good_8c.html#a22">npollfd</a>--;
00474     }
00475 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="mainloop_good.c::flowecho" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void flowecho           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>i</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
do "flow" control for echo 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>i</em>&nbsp;</td><td>index into pollfds/clients array for echo session</td></tr>
  </table>
</dl>
turn off checking for read if buffer is full resp. write if buffer is empty. 
<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00646">646</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__bad_8c-source.html#l00042">BUFSIZE</a>, <a class="el" href="mainloop__good_8c-source.html#l00132">clients</a>, <a class="el" href="mainloop__good_8c-source.html#l00098">client_t::echo</a>, <a class="el" href="mainloop__good_8c-source.html#l00068">echo_client_t::n</a>, and <a class="el" href="mainloop__good_8c-source.html#l00133">pollfds</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00551">readecho()</a>, and <a class="el" href="mainloop__good_8c-source.html#l00598">writeecho()</a>.
<p>
<pre class="fragment"><div>00647 {
00648     <span class="keywordflow">switch</span> (<a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o4">echo</a>.<a class="code" href="structecho__client__t.html#o2">n</a>) {
00649     <span class="keywordflow">case</span> 0:
00650         <a class="code" href="mainloop__good_8c.html#a24">pollfds</a>[i].events = POLLIN;
00651         <span class="keywordflow">break</span>;
00652     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a4">BUFSIZE</a>:
00653         <a class="code" href="mainloop__good_8c.html#a24">pollfds</a>[i].events = POLLOUT;
00654         <span class="keywordflow">break</span>;
00655     <span class="keywordflow">default</span>:
00656         <a class="code" href="mainloop__good_8c.html#a24">pollfds</a>[i].events = POLLIN | POLLOUT;
00657     }
00658 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="mainloop_good.c::heartbeat" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void heartbeat           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
print heartbeat message 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00335">335</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00047">MSG_HEARTBEAT</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00734">main()</a>.
<p>
<pre class="fragment"><div>00336 {
00337     <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_HEARTBEAT);
00338 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="mainloop_good.c::initalarms" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void initalarms           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
install non-resetting signal handler for alarms 
<p>
The sigaction interface allows installing non-resetting signal handlers (ie not reset to SIG_DFL after disposition). This way, there is no race condition when reinstalling the signal handler. 
<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00235">235</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00307">alarmhandler()</a>, <a class="el" href="mainloop__good_8c-source.html#l00134">alarms</a>, <a class="el" href="mainloop__good_8c-source.html#l00115">alarm_t::handler</a>, and <a class="el" href="mainloop__good_8c-source.html#l00043">MAXALARMS</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00734">main()</a>.
<p>
<pre class="fragment"><div>00236 {
00237     <span class="keyword">struct </span>sigaction act;
00238     <span class="keywordtype">int</span>             i;
00239 
00240     act.sa_handler = <a class="code" href="mainloop__good_8c.html#a31">alarmhandler</a>;
00241     sigemptyset(&amp;act.sa_mask);
00242     act.sa_flags = 0;           <span class="comment">/* no SIG_RESTART! */</span>
00243     <span class="keywordflow">if</span> (sigaction(SIGALRM, &amp;act, NULL) == -1) {
00244         perror(<span class="stringliteral">"sigaction(SIGPIPE, &lt;ignore&gt;)"</span>);
00245         exit(EXIT_FAILURE);
00246     }
00247     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="mainloop__good_8c.html#a6">MAXALARMS</a>; i++) {
00248         <a class="code" href="mainloop__good_8c.html#a25">alarms</a>[i].<a class="code" href="structalarm__t.html#o0">handler</a> = NULL;
00249     }
00250     alarm(0);                   <span class="comment">/* cancel any previously made alarm request */</span>
00251 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="mainloop_good.c::initclients" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void initclients           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
initialize client state array 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00418">418</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00132">clients</a>, <a class="el" href="mainloop__good_8c-source.html#l00093">client_t::fd</a>, <a class="el" href="mainloop__bad_8c-source.html#l00045">MAXCLIENTS</a>, and <a class="el" href="mainloop__good_8c-source.html#l00131">npollfd</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00734">main()</a>.
<p>
<pre class="fragment"><div>00419 {
00420     <span class="keywordtype">int</span>             i;
00421 
00422     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="mainloop__bad_8c.html#a5">MAXCLIENTS</a>; i++) {
00423         <a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o0">fd</a> = -1;
00424     }
00425     <a class="code" href="mainloop__good_8c.html#a22">npollfd</a> = 0;
00426 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="mainloop_good.c::listensocket" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int listensocket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>port</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
return tcp socket listening on port specified 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>port</em>&nbsp;</td><td>port number in host byte order</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>file descriptor for listening socket</dd></dl>
The socket is set to be nonblocking 
<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00359">359</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00406">setnonblock()</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00257">listensource()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00379">main()</a>.
<p>
<pre class="fragment"><div>00360 {
00361     <span class="keywordtype">int</span>             serverfd;
00362     <span class="keyword">struct </span>sockaddr_in sain;
00363     <span class="keywordtype">int</span>             one;
00364 
00365     <span class="comment">/* set up tcp socket for listening */</span>
00366     sain.sin_family = AF_INET;
00367     sain.sin_port = htons(port);
00368     sain.sin_addr.s_addr = INADDR_ANY;
00369     <span class="keywordflow">if</span> ((serverfd = socket(AF_INET, SOCK_STREAM, 0)) == -1) {
00370         perror(<span class="stringliteral">"socket(AF_INET, SOCK_STREAM, 0)"</span>);
00371         exit(EXIT_FAILURE);
00372     }
00373     one = 1;
00374     <span class="keywordflow">if</span> (setsockopt
00375         (serverfd, SOL_SOCKET, SO_REUSEADDR, &amp;one,
00376          (<span class="keywordtype">int</span>) <span class="keyword">sizeof</span>(one)) == -1) {
00377         perror(<span class="stringliteral">"setsockopt(SO_REUSEADDR)"</span>);
00378         exit(EXIT_FAILURE);
00379     }
00380     <span class="keywordflow">if</span> (bind
00381         (serverfd, (<span class="keyword">struct </span>sockaddr *) &amp;sain, <span class="keyword">sizeof</span>(<span class="keyword">struct </span>sockaddr_in))
00382         == -1) {
00383         perror(<span class="stringliteral">"bind()"</span>);
00384         exit(EXIT_FAILURE);
00385     }
00386     <span class="keywordflow">if</span> (listen(serverfd, 5) == -1) {
00387         perror(<span class="stringliteral">"listen()"</span>);
00388         exit(EXIT_FAILURE);
00389     }
00390     <a class="code" href="mainloop__good_8c.html#a35">setnonblock</a>(serverfd);
00391 
00392     printf(<span class="stringliteral">"listening on port %d\n"</span>, port);
00393 
00394     <span class="keywordflow">return</span> serverfd;
00395 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="mainloop_good.c::main" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int main           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00734">734</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00680">acceptchargen()</a>, <a class="el" href="mainloop__good_8c-source.html#l00524">acceptecho()</a>, <a class="el" href="mainloop__good_8c-source.html#l00263">addalarm()</a>, <a class="el" href="mainloop__good_8c-source.html#l00437">addclient()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00170">blocksigpipe()</a>, <a class="el" href="mainloop__good_8c-source.html#l00335">heartbeat()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00036">HEARTBEAT_INTERVAL</a>, <a class="el" href="mainloop__good_8c-source.html#l00235">initalarms()</a>, <a class="el" href="mainloop__good_8c-source.html#l00418">initclients()</a>, <a class="el" href="mainloop__good_8c-source.html#l00359">listensocket()</a>, <a class="el" href="mainloop__good_8c-source.html#l00481">mainloop()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00033">PORT_CHARGEN</a>, <a class="el" href="mainloop__bad_8c-source.html#l00030">PORT_ECHO</a>, <a class="el" href="mainloop__good_8c-source.html#l00344">slowheartbeat()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00039">SLOWHEARTBEAT_INTERVAL</a>.
<p>
<pre class="fragment"><div>00735 {
00736     printf(<span class="stringliteral">"example: better main loop\n"</span>);
00737 
00738     <a class="code" href="mainloop__glib_8c.html#a35">blocksigpipe</a>();
00739 
00740     <a class="code" href="mainloop__good_8c.html#a36">initclients</a>();
00741     <a class="code" href="mainloop__good_8c.html#a37">addclient</a>(<a class="code" href="mainloop__good_8c.html#a34">listensocket</a>(PORT_ECHO), &amp;acceptecho, NULL, NULL);
00742     <a class="code" href="mainloop__good_8c.html#a37">addclient</a>(<a class="code" href="mainloop__good_8c.html#a34">listensocket</a>(PORT_CHARGEN), &amp;acceptchargen, NULL, NULL);
00743     <a class="code" href="mainloop__good_8c.html#a28">initalarms</a>();
00744     <a class="code" href="mainloop__good_8c.html#a29">addalarm</a>(heartbeat, HEARTBEAT_INTERVAL);
00745     <a class="code" href="mainloop__good_8c.html#a29">addalarm</a>(slowheartbeat, SLOWHEARTBEAT_INTERVAL);
00746     printf(<span class="stringliteral">"heartbeat every %d seconds\n"</span>, HEARTBEAT_INTERVAL);
00747     printf(<span class="stringliteral">"slow heartbeat every %d seconds\n"</span>, SLOWHEARTBEAT_INTERVAL);
00748 
00749     <span class="comment">/* main loop */</span>
00750     <span class="keywordflow">while</span> (1) {
00751         <a class="code" href="mainloop__good_8c.html#a39">mainloop</a>();
00752     }
00753     <span class="comment">/* notreached */</span>
00754 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="mainloop_good.c::mainloop" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void mainloop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
execute one iteration of THE mainloop 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00481">481</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00285">checkalarms()</a>, <a class="el" href="mainloop__good_8c-source.html#l00132">clients</a>, <a class="el" href="mainloop__good_8c-source.html#l00096">client_t::except</a>, <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00049">MSG_MAINLOOP</a>, <a class="el" href="mainloop__good_8c-source.html#l00131">npollfd</a>, <a class="el" href="mainloop__good_8c-source.html#l00133">pollfds</a>, <a class="el" href="mainloop__good_8c-source.html#l00094">client_t::read</a>, and <a class="el" href="mainloop__good_8c-source.html#l00095">client_t::write</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00734">main()</a>.
<p>
<pre class="fragment"><div>00482 {
00483     <span class="keywordtype">int</span>             i;
00484 
00485     <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_MAINLOOP);
00486     i = poll(pollfds, npollfd, -1);
00487 
00488     <span class="comment">/* check for alarm handlers to be executed */</span>
00489     <a class="code" href="mainloop__good_8c.html#a30">checkalarms</a>();
00490 
00491     <span class="keywordflow">if</span> (i == -1) {
00492         <span class="keywordflow">if</span> ((errno != EAGAIN) &amp;&amp; (errno != EINTR)) {
00493             perror(<span class="stringliteral">"poll()"</span>);
00494             exit(EXIT_FAILURE);
00495         }
00496         <span class="keywordflow">return</span>;
00497     }
00498 
00499     <span class="comment">/* </span>
00500 <span class="comment">     * handle i/o events. work off exceptions first. then read (try to fill</span>
00501 <span class="comment">     * buffer) and write (try to empty buffer)</span>
00502 <span class="comment">     */</span>
00503     <span class="keywordflow">for</span> (i = 0; i &lt;= <a class="code" href="mainloop__good_8c.html#a22">npollfd</a>; i++) {
00504         <span class="keywordflow">if</span> ((<a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o3">except</a>)
00505             &amp;&amp; (<a class="code" href="mainloop__good_8c.html#a24">pollfds</a>[i].revents &amp; (POLLERR | POLLHUP | POLLNVAL))) {
00506             (*<a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o3">except</a>) (i);
00507             <span class="keywordflow">continue</span>;
00508         }
00509         <span class="keywordflow">if</span> ((<a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o1">read</a>) &amp;&amp; (<a class="code" href="mainloop__good_8c.html#a24">pollfds</a>[i].revents &amp; POLLIN)) {
00510             (*<a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o1">read</a>) (i);
00511         }
00512         <span class="keywordflow">if</span> ((<a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o2">write</a>) &amp;&amp; (<a class="code" href="mainloop__good_8c.html#a24">pollfds</a>[i].revents &amp; POLLOUT)) {
00513             (*<a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o2">write</a>) (i);
00514         }
00515     }
00516 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="mainloop_good.c::message" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void message           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
print message describing current activity 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>msg</em>&nbsp;</td><td>id of message to print (MSG_XYZ) </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00170">170</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__bad_8c-source.html#l00050">MSG_ACCEPT</a>, <a class="el" href="mainloop__bad_8c-source.html#l00052">MSG_CLOSE</a>, <a class="el" href="mainloop__bad_8c-source.html#l00056">MSG_EMPTY</a>, <a class="el" href="mainloop__bad_8c-source.html#l00055">MSG_FULL</a>, <a class="el" href="mainloop__bad_8c-source.html#l00047">MSG_HEARTBEAT</a>, <a class="el" href="mainloop__bad_8c-source.html#l00049">MSG_MAINLOOP</a>, <a class="el" href="mainloop__bad_8c-source.html#l00053">MSG_READ</a>, <a class="el" href="mainloop__bad_8c-source.html#l00048">MSG_SLOWHEARTBEAT</a>, <a class="el" href="mainloop__bad_8c-source.html#l00051">MSG_TOOMANY</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00054">MSG_WRITE</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00347">accept_dispatch()</a>, <a class="el" href="mainloop__good_8c-source.html#l00524">acceptecho()</a>, <a class="el" href="mainloop__good_8c-source.html#l00437">addclient()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00633">chargen_dispatch()</a>, <a class="el" href="mainloop__good_8c-source.html#l00666">closeclient()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00498">echo_dispatch_read()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00546">echo_dispatch_write()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00281">heartbeat()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00379">main()</a>, <a class="el" href="mainloop__good_8c-source.html#l00481">mainloop()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00257">readecho()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00139">sighandler()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00293">slowheartbeat()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00592">source_close()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00350">writechargen()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00304">writeecho()</a>.
<p>
<pre class="fragment"><div>00171 {
00172     <span class="keywordflow">switch</span> (msg) {
00173     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a6">MSG_HEARTBEAT</a>:
00174         printf(<span class="stringliteral">"H"</span>);
00175         <span class="keywordflow">break</span>;
00176     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a7">MSG_SLOWHEARTBEAT</a>:
00177         printf(<span class="stringliteral">"S"</span>);
00178         <span class="keywordflow">break</span>;
00179     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a8">MSG_MAINLOOP</a>:
00180         <span class="comment">/* printf("M"); */</span>
00181         <span class="keywordflow">break</span>;
00182     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a9">MSG_ACCEPT</a>:
00183         printf(<span class="stringliteral">"A"</span>);
00184         <span class="keywordflow">break</span>;
00185     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a10">MSG_TOOMANY</a>:
00186         printf(<span class="stringliteral">"T"</span>);
00187         <span class="keywordflow">break</span>;
00188     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a11">MSG_CLOSE</a>:
00189         printf(<span class="stringliteral">"C"</span>);
00190         <span class="keywordflow">break</span>;
00191     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a12">MSG_READ</a>:
00192         printf(<span class="stringliteral">"R"</span>);
00193         <span class="keywordflow">break</span>;
00194     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a13">MSG_WRITE</a>:
00195         printf(<span class="stringliteral">"W"</span>);
00196         <span class="keywordflow">break</span>;
00197     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a14">MSG_FULL</a>:
00198         printf(<span class="stringliteral">"F"</span>);
00199         <span class="keywordflow">break</span>;
00200     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a15">MSG_EMPTY</a>:
00201         printf(<span class="stringliteral">"E"</span>);
00202         <span class="keywordflow">break</span>;
00203     }
00204     fflush(stdout);
00205 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="mainloop_good.c::readecho" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void readecho           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>i</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
read data from echo client 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>i</em>&nbsp;</td><td>index into pollfds/clients array for echo session</td></tr>
  </table>
</dl>
If the buffer is not full, tries to do one read from the filedescriptor associated with this echo client. 
<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00551">551</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__bad_8c-source.html#l00042">BUFSIZE</a>, <a class="el" href="mainloop__good_8c-source.html#l00132">clients</a>, <a class="el" href="mainloop__good_8c-source.html#l00666">closeclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00098">client_t::echo</a>, <a class="el" href="mainloop__good_8c-source.html#l00646">flowecho()</a>, <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00055">MSG_FULL</a>, <a class="el" href="mainloop__bad_8c-source.html#l00053">MSG_READ</a>, <a class="el" href="mainloop__good_8c-source.html#l00068">echo_client_t::n</a>, <a class="el" href="mainloop__good_8c-source.html#l00066">echo_client_t::r</a>, and <a class="el" href="mainloop__good_8c-source.html#l00067">echo_client_t::w</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00524">acceptecho()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00379">main()</a>.
<p>
<pre class="fragment"><div>00552 {
00553     ssize_t         nread;
00554 
00555     <span class="keywordflow">if</span> (<a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o4">echo</a>.<a class="code" href="structecho__client__t.html#o2">n</a> == <a class="code" href="mainloop__bad_8c.html#a4">BUFSIZE</a>) {
00556         <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_FULL);
00557         <a class="code" href="mainloop__good_8c.html#a44">flowecho</a>(i);
00558         <span class="keywordflow">return</span>;
00559     }
00560     <span class="keywordflow">if</span> (<a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o4">echo</a>.<a class="code" href="structecho__client__t.html#o0">r</a> &gt;= <a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o4">echo</a>.<a class="code" href="structecho__client__t.html#o1">w</a>) {
00561         nread =
00562             read(clients[i].fd, clients[i].echo.buf + clients[i].echo.r,
00563                  BUFSIZE - clients[i].echo.r);
00564     } <span class="keywordflow">else</span> {
00565         nread =
00566             read(clients[i].fd, clients[i].echo.buf + clients[i].echo.r,
00567                  clients[i].echo.w - clients[i].echo.r);
00568     }
00569 
00570     <span class="keywordflow">switch</span> (nread) {
00571     <span class="keywordflow">case</span> -1:
00572         <span class="keywordflow">if</span> ((errno != EINTR) &amp;&amp; (errno != EWOULDBLOCK)) {
00573             perror(<span class="stringliteral">"read()"</span>);
00574             exit(EXIT_FAILURE);
00575         }
00576         <span class="keywordflow">break</span>;
00577     <span class="keywordflow">case</span> 0:
00578         <a class="code" href="mainloop__good_8c.html#a40">closeclient</a>(i);
00579         <span class="keywordflow">return</span>;
00580     <span class="keywordflow">default</span>:
00581         <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_READ);
00582         <a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o4">echo</a>.<a class="code" href="structecho__client__t.html#o2">n</a> += nread;
00583         <a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o4">echo</a>.<a class="code" href="structecho__client__t.html#o0">r</a> += nread;
00584         <a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o4">echo</a>.<a class="code" href="structecho__client__t.html#o0">r</a> %= <a class="code" href="mainloop__bad_8c.html#a4">BUFSIZE</a>;
00585         <a class="code" href="mainloop__good_8c.html#a44">flowecho</a>(i);
00586     }
00587 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="mainloop_good.c::setnonblock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void setnonblock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
set a file descriptor to be nonblocking 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>fd</em>&nbsp;</td><td>file descriptor</td></tr>
  </table>
</dl>
Non-Blocking works only for Sockets, Pipes and slow devices, it has no effect when used with regular files or "fast" devices. 
<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00406">406</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00347">accept_dispatch()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00193">listensocket()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00379">main()</a>.
<p>
<pre class="fragment"><div>00407 {
00408     <span class="keywordtype">int</span>             flag;
00409 
00410     flag = fcntl(fd, F_GETFL);
00411     fcntl(fd, F_GETFL, flag | O_NONBLOCK);
00412 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="mainloop_good.c::slowheartbeat" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void slowheartbeat           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
print "slowheartbeat" message 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00344">344</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00048">MSG_SLOWHEARTBEAT</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00734">main()</a>.
<p>
<pre class="fragment"><div>00345 {
00346     <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_SLOWHEARTBEAT);
00347 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="mainloop_good.c::writechargen" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void writechargen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>i</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
write data to an chargen client 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>i</em>&nbsp;</td><td>index into pollfds/clients array for chargen session</td></tr>
  </table>
</dl>
If the buffer is not empty, tries to do one write to the filedescriptor associated with the chargen client. 
<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00706">706</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00099">client_t::chargen</a>, <a class="el" href="mainloop__good_8c-source.html#l00060">chargen_buf</a>, <a class="el" href="mainloop__good_8c-source.html#l00132">clients</a>, <a class="el" href="mainloop__good_8c-source.html#l00666">closeclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00076">chargen_client_t::i</a>, <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00054">MSG_WRITE</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00680">acceptchargen()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00379">main()</a>.
<p>
<pre class="fragment"><div>00707 {
00708     ssize_t         nwrite;
00709 
00710     nwrite =
00711         write(clients[i].fd, chargen_buf + clients[i].chargen.i,
00712               <span class="keyword">sizeof</span>(chargen_buf) - clients[i].chargen.i);
00713 
00714     <span class="keywordflow">switch</span> (nwrite) {
00715     <span class="keywordflow">case</span> -1:
00716         <span class="keywordflow">if</span> (errno == EPIPE) {
00717             <a class="code" href="mainloop__good_8c.html#a40">closeclient</a>(i);
00718             <span class="keywordflow">return</span>;
00719         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((errno != EINTR) &amp;&amp; (errno != EWOULDBLOCK)) {
00720             perror(<span class="stringliteral">"write()"</span>);
00721             exit(EXIT_FAILURE);
00722         }
00723         <span class="keywordflow">break</span>;
00724     <span class="keywordflow">case</span> 0:
00725         <span class="keywordflow">break</span>;
00726     <span class="keywordflow">default</span>:
00727         <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_WRITE);
00728         <a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o5">chargen</a>.<a class="code" href="structchargen__client__t.html#o0">i</a> += nwrite;
00729         <a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o5">chargen</a>.<a class="code" href="structchargen__client__t.html#o0">i</a> %= <span class="keyword">sizeof</span>(<a class="code" href="mainloop__good_8c.html#a19">chargen_buf</a>);
00730     }
00731 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="mainloop_good.c::writeecho" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void writeecho           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>i</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
write data to an echo client 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>i</em>&nbsp;</td><td>index into pollfds/clients array for echo session</td></tr>
  </table>
</dl>
If the buffer is not empty, tries to do one write to the filedescriptor associated with the echo client. 
<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00598">598</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
References <a class="el" href="mainloop__bad_8c-source.html#l00042">BUFSIZE</a>, <a class="el" href="mainloop__good_8c-source.html#l00132">clients</a>, <a class="el" href="mainloop__good_8c-source.html#l00666">closeclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00098">client_t::echo</a>, <a class="el" href="mainloop__good_8c-source.html#l00646">flowecho()</a>, <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00056">MSG_EMPTY</a>, <a class="el" href="mainloop__bad_8c-source.html#l00054">MSG_WRITE</a>, <a class="el" href="mainloop__good_8c-source.html#l00068">echo_client_t::n</a>, <a class="el" href="mainloop__good_8c-source.html#l00066">echo_client_t::r</a>, and <a class="el" href="mainloop__good_8c-source.html#l00067">echo_client_t::w</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00524">acceptecho()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00379">main()</a>.
<p>
<pre class="fragment"><div>00599 {
00600     ssize_t         nwrite;
00601 
00602     <span class="keywordflow">if</span> (<a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o4">echo</a>.<a class="code" href="structecho__client__t.html#o2">n</a> == 0) {
00603         <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_EMPTY);
00604         <a class="code" href="mainloop__good_8c.html#a44">flowecho</a>(i);
00605         <span class="keywordflow">return</span>;
00606     }
00607     <span class="keywordflow">if</span> (<a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o4">echo</a>.<a class="code" href="structecho__client__t.html#o0">r</a> &gt; <a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o4">echo</a>.<a class="code" href="structecho__client__t.html#o1">w</a>) {
00608         nwrite =
00609             write(clients[i].fd, clients[i].echo.buf + clients[i].echo.w,
00610                   clients[i].echo.r - clients[i].echo.w);
00611     } <span class="keywordflow">else</span> {
00612         nwrite =
00613             write(clients[i].fd, clients[i].echo.buf + clients[i].echo.w,
00614                   BUFSIZE - clients[i].echo.w);
00615     }
00616 
00617     <span class="keywordflow">switch</span> (nwrite) {
00618     <span class="keywordflow">case</span> -1:
00619         <span class="keywordflow">if</span> (errno == EPIPE) {
00620             <a class="code" href="mainloop__good_8c.html#a40">closeclient</a>(i);
00621         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((errno != EINTR) &amp;&amp; (errno != EWOULDBLOCK)) {
00622             perror(<span class="stringliteral">"write()"</span>);
00623             exit(EXIT_FAILURE);
00624         }
00625         <span class="keywordflow">break</span>;
00626     <span class="keywordflow">case</span> 0:
00627         <span class="keywordflow">break</span>;
00628     <span class="keywordflow">default</span>:
00629         <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_WRITE);
00630         <a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o4">echo</a>.<a class="code" href="structecho__client__t.html#o2">n</a> -= nwrite;
00631         <a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o4">echo</a>.<a class="code" href="structecho__client__t.html#o1">w</a> += nwrite;
00632         <a class="code" href="mainloop__good_8c.html#a23">clients</a>[i].<a class="code" href="structclient__t.html#o4">echo</a>.<a class="code" href="structecho__client__t.html#o1">w</a> %= <a class="code" href="mainloop__bad_8c.html#a4">BUFSIZE</a>;
00633         <a class="code" href="mainloop__good_8c.html#a44">flowecho</a>(i);
00634     }
00635 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a25" doxytag="mainloop_good.c::alarms" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="structalarm__t.html">alarm_t</a> <a class="el" href="mainloop__good_8c.html#a25">alarms</a>[MAXALARMS]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
alarms 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00134">134</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00263">addalarm()</a>, <a class="el" href="mainloop__good_8c-source.html#l00307">alarmhandler()</a>, <a class="el" href="mainloop__good_8c-source.html#l00285">checkalarms()</a>, and <a class="el" href="mainloop__good_8c-source.html#l00235">initalarms()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="mainloop_good.c::chargen_buf" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char <a class="el" href="mainloop__good_8c.html#a19">chargen_buf</a>[] = "0123456789abcdefghijklmnopqrstuv"<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
characters to return in chargen service 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00060">60</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00706">writechargen()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="mainloop_good.c::clients" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="structclient__t.html">client_t</a> <a class="el" href="mainloop__good_8c.html#a23">clients</a>[MAXCLIENTS]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
array of client states 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00132">132</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00680">acceptchargen()</a>, <a class="el" href="mainloop__good_8c-source.html#l00524">acceptecho()</a>, <a class="el" href="mainloop__good_8c-source.html#l00437">addclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00666">closeclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00466">delclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00646">flowecho()</a>, <a class="el" href="mainloop__good_8c-source.html#l00418">initclients()</a>, <a class="el" href="mainloop__good_8c-source.html#l00481">mainloop()</a>, <a class="el" href="mainloop__good_8c-source.html#l00551">readecho()</a>, <a class="el" href="mainloop__good_8c-source.html#l00706">writechargen()</a>, and <a class="el" href="mainloop__good_8c-source.html#l00598">writeecho()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="mainloop_good.c::npollfd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> unsigned long <a class="el" href="mainloop__good_8c.html#a22">npollfd</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
number of file descriptors to check 
<p>
this is not as bad as it sounds because there's a static array for the struct pollfd anyway (pollfds). using an array for the client states allows using the same index for pollfds and clients.<p>
in a real application, the buffer would be bigger, and therefore wouldn't be placed into the array ;) for demonstration purposes, the buffer is small to make it more interesting 
<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00131">131</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00437">addclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00466">delclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00418">initclients()</a>, and <a class="el" href="mainloop__good_8c-source.html#l00481">mainloop()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="mainloop_good.c::pollfds" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct pollfd <a class="el" href="mainloop__good_8c.html#a24">pollfds</a>[MAXCLIENTS]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
pollfds for poll() 
<p>

<p>
Definition at line <a class="el" href="mainloop__good_8c-source.html#l00133">133</a> of file <a class="el" href="mainloop__good_8c-source.html">mainloop_good.c</a>.
<p>
Referenced by <a class="el" href="mainloop__good_8c-source.html#l00437">addclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00466">delclient()</a>, <a class="el" href="mainloop__good_8c-source.html#l00646">flowecho()</a>, and <a class="el" href="mainloop__good_8c-source.html#l00481">mainloop()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jul 19 16:02:07 2004 for mainloop by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
