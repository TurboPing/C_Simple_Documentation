<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mainloop: mainloop_glib.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>mainloop_glib.c File Reference</h1>Example for main loop using glib 2.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;errno.h&gt;</code><br>
<code>#include &lt;sys/time.h&gt;</code><br>
<code>#include &lt;sys/socket.h&gt;</code><br>
<code>#include &lt;signal.h&gt;</code><br>
<code>#include &lt;fcntl.h&gt;</code><br>
<code>#include "glib.h"</code><br>

<p>
<a href="mainloop__glib_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="structlisten__source__t.html">listen_source_t</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">listen source state  <a href="structlisten__source__t.html#_details">More...</a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="structecho__source__t.html">echo_source_t</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">echo source state  <a href="structecho__source__t.html#_details">More...</a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="structchargen__source__t.html">chargen_source_t</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">chargen source state  <a href="structchargen__source__t.html#_details">More...</a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="structsource__t.html">source_t</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a0">PORT_ECHO</a>&nbsp;&nbsp;&nbsp;5005</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">tcp port to listen for echo clients  <a href="#a0"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a1">PORT_CHARGEN</a>&nbsp;&nbsp;&nbsp;5006</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">tcp port to listen for chargen clients  <a href="#a1"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a2">HEARTBEAT_INTERVAL</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">heartbeat interval (in seconds)  <a href="#a2"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a3">SLOWHEARTBEAT_INTERVAL</a>&nbsp;&nbsp;&nbsp;15</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">slow heartbeat interval (in seconds)  <a href="#a3"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a4">BUFSIZE</a>&nbsp;&nbsp;&nbsp;16</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">buffer size for echo client  <a href="#a4"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a5">MSG_HEARTBEAT</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a6">MSG_SLOWHEARTBEAT</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a7">MSG_MAINLOOP</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a8">MSG_ACCEPT</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a9">MSG_TOOMANY</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a10">MSG_CLOSE</a>&nbsp;&nbsp;&nbsp;5</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a11">MSG_READ</a>&nbsp;&nbsp;&nbsp;6</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a12">MSG_WRITE</a>&nbsp;&nbsp;&nbsp;7</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a13">MSG_FULL</a>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a14">MSG_EMPTY</a>&nbsp;&nbsp;&nbsp;9</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef GSource *(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a16">getclientsourcefunc</a> )()</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a17">message</a> (int msg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">print message describing current activity  <a href="#a17"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a18">listensocket</a> (int port)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">return tcp socket listening on port specified  <a href="#a18"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a19">setnonblock</a> (int fd)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">set a file descriptor to be nonblocking  <a href="#a19"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structsource__t.html">source_t</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a20">listensource</a> (<a class="el" href="mainloop__glib_8c.html#a16">getclientsourcefunc</a> getclientsource, int port)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">construct listensource listening on port specified  <a href="#a20"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>GSource *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a21">getechoclientsource</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">construct GSourceFuncs for echo client  <a href="#a21"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>GSource *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a22">getchargenclientsource</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">construct GSourceFuncs for chargen client  <a href="#a22"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>gboolean&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a23">heartbeat</a> (gpointer data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">print heartbeat message  <a href="#a23"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>gboolean&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a24">slowheartbeat</a> (gpointer data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">print "slowheartbeat" message  <a href="#a24"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>gboolean&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a25">check</a> (GSource *source)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">check whether source is ready for processing  <a href="#a25"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a26">source_close</a> (<a class="el" href="structsource__t.html">source_t</a> *source)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">close a source and dispose of source  <a href="#a26"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>gboolean&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a27">accept_prepare</a> (GSource *source, gint *timeout)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare GSource for polling a server socket for accept.  <a href="#a27"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>gboolean&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a28">accept_dispatch</a> (GSource *source, GSourceFunc callback, gpointer user_data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">dispatch (process) listening socket  <a href="#a28"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>gboolean&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a29">echo_prepare</a> (GSource *source, gint *timeout)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare GSource for polling an echo client.  <a href="#a29"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>gboolean&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a30">echo_dispatch</a> (GSource *source, GSourceFunc callback, gpointer user_data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">dispatch (process) echo client  <a href="#a30"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a31">echo_dispatch_read</a> (<a class="el" href="structsource__t.html">source_t</a> *echosource)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">read data from echo client  <a href="#a31"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a32">echo_dispatch_write</a> (<a class="el" href="structsource__t.html">source_t</a> *echosource)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">write data to an echo client  <a href="#a32"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>gboolean&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a33">chargen_prepare</a> (GSource *source, gint *timeout)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare GSource for polling an chargen client.  <a href="#a33"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>gboolean&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a34">chargen_dispatch</a> (GSource *source, GSourceFunc callback, gpointer user_data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">dispatch (process) chargen client  <a href="#a34"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a35">blocksigpipe</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">block SIGPIPE  <a href="#a35"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a36">main</a> ()</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>char&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="mainloop__glib_8c.html#a15">chargen_buf</a> [] = "0123456789abcdefghijklmnopqrstuv"</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">characters to return in chargen service  <a href="#a15"></a><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Example for main loop using glib 2. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>Rico Pajarola</dd></dl>
This example uses glib 2 for handling events.
<p>
Definition in file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="a4" doxytag="mainloop_glib.c::BUFSIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BUFSIZE&nbsp;&nbsp;&nbsp;16          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
buffer size for echo client 
<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00035">35</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="mainloop_glib.c::HEARTBEAT_INTERVAL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define HEARTBEAT_INTERVAL&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
heartbeat interval (in seconds) 
<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00029">29</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="mainloop_glib.c::MSG_ACCEPT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_ACCEPT&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00040">40</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="mainloop_glib.c::MSG_CLOSE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_CLOSE&nbsp;&nbsp;&nbsp;5          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00042">42</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="mainloop_glib.c::MSG_EMPTY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_EMPTY&nbsp;&nbsp;&nbsp;9          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00046">46</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="mainloop_glib.c::MSG_FULL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_FULL&nbsp;&nbsp;&nbsp;8          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00045">45</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="mainloop_glib.c::MSG_HEARTBEAT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_HEARTBEAT&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00037">37</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="mainloop_glib.c::MSG_MAINLOOP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_MAINLOOP&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00039">39</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="mainloop_glib.c::MSG_READ" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_READ&nbsp;&nbsp;&nbsp;6          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00043">43</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="mainloop_glib.c::MSG_SLOWHEARTBEAT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_SLOWHEARTBEAT&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00038">38</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="mainloop_glib.c::MSG_TOOMANY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_TOOMANY&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00041">41</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="mainloop_glib.c::MSG_WRITE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MSG_WRITE&nbsp;&nbsp;&nbsp;7          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00044">44</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="mainloop_glib.c::PORT_CHARGEN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PORT_CHARGEN&nbsp;&nbsp;&nbsp;5006          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
tcp port to listen for chargen clients 
<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00026">26</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="mainloop_glib.c::PORT_ECHO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PORT_ECHO&nbsp;&nbsp;&nbsp;5005          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
tcp port to listen for echo clients 
<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00023">23</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="mainloop_glib.c::SLOWHEARTBEAT_INTERVAL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SLOWHEARTBEAT_INTERVAL&nbsp;&nbsp;&nbsp;15          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
slow heartbeat interval (in seconds) 
<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00032">32</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a16" doxytag="mainloop_glib.c::getclientsourcefunc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef GSource*(* <a class="el" href="mainloop__glib_8c.html#a16">getclientsourcefunc</a>)()          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00051">51</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a28" doxytag="mainloop_glib.c::accept_dispatch" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> gboolean accept_dispatch           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">GSource *&nbsp;</td>
          <td class="mdname" nowrap> <em>gsource</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>GSourceFunc&nbsp;</td>
          <td class="mdname" nowrap> <em>callback</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>gpointer&nbsp;</td>
          <td class="mdname" nowrap> <em>user_data</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
dispatch (process) listening socket 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>gsource</em>&nbsp;</td><td>source to process </td></tr>
    <tr><td></td><td valign=top><em>callback</em>&nbsp;</td><td>callback function (unused) </td></tr>
    <tr><td></td><td valign=top><em>user_data</em>&nbsp;</td><td>I have absolutely no idea how to use this... nice idea though</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>always TRUE </dd></dl>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00347">347</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__glib_8c-source.html#l00057">listen_source_t::getclientsource</a>, <a class="el" href="mainloop__glib_8c-source.html#l00083">source_t::listen</a>, <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00050">MSG_ACCEPT</a>, <a class="el" href="mainloop__glib_8c-source.html#l00079">source_t::pollfd</a>, and <a class="el" href="mainloop__good_8c-source.html#l00406">setnonblock()</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00257">listensource()</a>.
<p>
<pre class="fragment"><div>00349 {
00350     <span class="keyword">struct </span>sockaddr_in sain;
00351     <span class="keywordtype">int</span>             fd;
00352     socklen_t       t;
00353     <a class="code" href="structsource__t.html">source_t</a>       *source;
00354     <a class="code" href="structsource__t.html">source_t</a>       *clientsource;
00355 
00356     source = (<a class="code" href="structsource__t.html">source_t</a> *) gsource;
00357 
00358     <span class="keywordflow">if</span> (source-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.revents &amp; (G_IO_HUP | G_IO_ERR)) {
00359         perror(<span class="stringliteral">"accept_dispatch()"</span>);
00360         exit(EXIT_FAILURE);
00361     }
00362 
00363     <span class="comment">/* accept new connection */</span>
00364     t = <span class="keyword">sizeof</span>(sain);
00365     <span class="keywordflow">if</span> ((fd = accept(source-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.fd, (<span class="keywordtype">void</span> *) &amp;sain, &amp;t)) == -1) {
00366         <span class="keywordflow">if</span> (errno == EWOULDBLOCK) {
00367             <span class="keywordflow">return</span> TRUE;
00368         }
00369         perror(<span class="stringliteral">"accept(ECHO)"</span>);
00370         exit(EXIT_FAILURE);
00371     }
00372     <a class="code" href="mainloop__good_8c.html#a35">setnonblock</a>(fd);
00373     <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_ACCEPT);
00374 
00375     clientsource = (<a class="code" href="structsource__t.html">source_t</a> *) source-&gt;<a class="code" href="structsource__t.html#o3">listen</a>.<a class="code" href="structlisten__source__t.html#o0">getclientsource</a>();
00376     clientsource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.fd = fd;
00377     g_source_add_poll((GSource *) clientsource, &amp;(clientsource-&gt;pollfd));
00378     clientsource-&gt;id =
00379         g_source_attach((GSource *) clientsource,
00380                         g_source_get_context((GSource *) clientsource));
00381     <span class="keywordflow">return</span> TRUE;
00382 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="mainloop_glib.c::accept_prepare" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> gboolean accept_prepare           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">GSource *&nbsp;</td>
          <td class="mdname" nowrap> <em>source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>gint *&nbsp;</td>
          <td class="mdname" nowrap> <em>timeout</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Prepare GSource for polling a server socket for accept. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>source</em>&nbsp;</td><td>GSource to prepare </td></tr>
    <tr><td></td><td valign=top><em>timeout</em>&nbsp;</td><td>maximum timeout to set for poll() (out)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>always FALSE (use poll) </dd></dl>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00326">326</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__glib_8c-source.html#l00079">source_t::pollfd</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00257">listensource()</a>.
<p>
<pre class="fragment"><div>00327 {
00328     <a class="code" href="structsource__t.html">source_t</a>       *xsource;
00329 
00330     xsource = (<a class="code" href="structsource__t.html">source_t</a> *) source;
00331 
00332     xsource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.events = G_IO_IN;
00333     *timeout = -1;              <span class="comment">/* no timeout */</span>
00334     <span class="keywordflow">return</span> FALSE;
00335 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="mainloop_glib.c::blocksigpipe" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void blocksigpipe           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
block SIGPIPE 
<p>
Trying to write to a socket when the other end has already closed the connection results in SIGPIPE. Not usefull in this context. 
<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00170">170</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00666">main()</a>.
<p>
<pre class="fragment"><div>00171 {
00172     <span class="keyword">struct </span>sigaction act;
00173 
00174     act.sa_handler = SIG_IGN;
00175     sigemptyset(&amp;act.sa_mask);
00176     act.sa_flags = SA_RESTART;
00177     <span class="keywordflow">if</span> (sigaction(SIGPIPE, &amp;act, NULL) == -1) {
00178         perror(<span class="stringliteral">"sigaction(SIGPIPE, &lt;ignore&gt;)"</span>);
00179         exit(EXIT_FAILURE);
00180     }
00181 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="mainloop_glib.c::chargen_dispatch" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> gboolean chargen_dispatch           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">GSource *&nbsp;</td>
          <td class="mdname" nowrap> <em>source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>GSourceFunc&nbsp;</td>
          <td class="mdname" nowrap> <em>callback</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>gpointer&nbsp;</td>
          <td class="mdname" nowrap> <em>user_data</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
dispatch (process) chargen client 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>source</em>&nbsp;</td><td>source to process </td></tr>
    <tr><td></td><td valign=top><em>callback</em>&nbsp;</td><td>callback function (unused) </td></tr>
    <tr><td></td><td valign=top><em>user_data</em>&nbsp;</td><td>?</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>always TRUE</dd></dl>
there is no chargen_dispatch_write, writing is done directly in chargen_dispatch 
<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00633">633</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__glib_8c-source.html#l00085">source_t::chargen</a>, <a class="el" href="mainloop__glib_8c-source.html#l00049">chargen_buf</a>, <a class="el" href="mainloop__glib_8c-source.html#l00074">chargen_source_t::i</a>, <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00054">MSG_WRITE</a>, <a class="el" href="mainloop__glib_8c-source.html#l00079">source_t::pollfd</a>, and <a class="el" href="mainloop__glib_8c-source.html#l00592">source_close()</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00414">getchargenclientsource()</a>.
<p>
<pre class="fragment"><div>00635 {
00636     ssize_t         nwrite;
00637     <a class="code" href="structsource__t.html">source_t</a>       *chargensource;
00638 
00639     chargensource = (<a class="code" href="structsource__t.html">source_t</a> *) source;
00640 
00641     nwrite =
00642         write(chargensource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.fd,
00643               chargen_buf + chargensource-&gt;<a class="code" href="structsource__t.html#o5">chargen</a>.<a class="code" href="structchargen__source__t.html#o0">i</a>,
00644               <span class="keyword">sizeof</span>(chargen_buf) - chargensource-&gt;<a class="code" href="structsource__t.html#o5">chargen</a>.<a class="code" href="structchargen__source__t.html#o0">i</a>);
00645     <span class="keywordflow">switch</span> (nwrite) {
00646     <span class="keywordflow">case</span> -1:
00647         <span class="keywordflow">if</span> (errno == EPIPE) {
00648             <a class="code" href="mainloop__glib_8c.html#a26">source_close</a>((<a class="code" href="structsource__t.html">source_t</a> *) chargensource);
00649             <span class="keywordflow">return</span> TRUE;
00650         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((errno != EINTR) &amp;&amp; (errno != EWOULDBLOCK)) {
00651             perror(<span class="stringliteral">"write()"</span>);
00652             exit(EXIT_FAILURE);
00653         }
00654         <span class="keywordflow">break</span>;
00655     <span class="keywordflow">case</span> 0:
00656         <span class="keywordflow">break</span>;
00657     <span class="keywordflow">default</span>:
00658         <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_WRITE);
00659         chargensource-&gt;<a class="code" href="structsource__t.html#o5">chargen</a>.<a class="code" href="structchargen__source__t.html#o0">i</a> += nwrite;
00660         chargensource-&gt;<a class="code" href="structsource__t.html#o5">chargen</a>.<a class="code" href="structchargen__source__t.html#o0">i</a> %= <span class="keyword">sizeof</span>(<a class="code" href="mainloop__glib_8c.html#a15">chargen_buf</a>);
00661     }
00662     <span class="keywordflow">return</span> TRUE;
00663 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="mainloop_glib.c::chargen_prepare" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> gboolean chargen_prepare           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">GSource *&nbsp;</td>
          <td class="mdname" nowrap> <em>source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>gint *&nbsp;</td>
          <td class="mdname" nowrap> <em>timeout</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Prepare GSource for polling an chargen client. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>source</em>&nbsp;</td><td>GSource to prepare </td></tr>
    <tr><td></td><td valign=top><em>timeout</em>&nbsp;</td><td>maximum timeout to set for poll() (out)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>always FALSE (use poll) </dd></dl>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00609">609</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__glib_8c-source.html#l00079">source_t::pollfd</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00414">getchargenclientsource()</a>.
<p>
<pre class="fragment"><div>00610 {
00611     <a class="code" href="structsource__t.html">source_t</a>       *chargensource;
00612 
00613     chargensource = (<a class="code" href="structsource__t.html">source_t</a> *) source;
00614 
00615     chargensource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.events = G_IO_OUT;
00616 
00617     <span class="keywordflow">return</span> FALSE;
00618 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="mainloop_glib.c::check" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> gboolean check           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">GSource *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>source</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
check whether source is ready for processing 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>source</em>&nbsp;</td><td>GSource to check</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>TRUE if resource is ready </dd></dl>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00307">307</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__glib_8c-source.html#l00079">source_t::pollfd</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00414">getchargenclientsource()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00390">getechoclientsource()</a>, and <a class="el" href="mainloop__glib_8c-source.html#l00257">listensource()</a>.
<p>
<pre class="fragment"><div>00308 {
00309 
00310     <a class="code" href="structsource__t.html">source_t</a>       *xsource;
00311 
00312     xsource = (<a class="code" href="structsource__t.html">source_t</a> *) source;
00313 
00314     <span class="keywordflow">return</span> xsource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.revents ? TRUE : FALSE;
00315 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="mainloop_glib.c::echo_dispatch" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> gboolean echo_dispatch           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">GSource *&nbsp;</td>
          <td class="mdname" nowrap> <em>source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>GSourceFunc&nbsp;</td>
          <td class="mdname" nowrap> <em>callback</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>gpointer&nbsp;</td>
          <td class="mdname" nowrap> <em>user_data</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
dispatch (process) echo client 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>source</em>&nbsp;</td><td>source to process </td></tr>
    <tr><td></td><td valign=top><em>callback</em>&nbsp;</td><td>callback function (unused) </td></tr>
    <tr><td></td><td valign=top><em>user_data</em>&nbsp;</td><td>?</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>always TRUE </dd></dl>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00471">471</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__glib_8c-source.html#l00498">echo_dispatch_read()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00546">echo_dispatch_write()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00079">source_t::pollfd</a>, and <a class="el" href="mainloop__glib_8c-source.html#l00592">source_close()</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00390">getechoclientsource()</a>.
<p>
<pre class="fragment"><div>00472 {
00473     <a class="code" href="structsource__t.html">source_t</a>       *echosource;
00474 
00475     echosource = (<a class="code" href="structsource__t.html">source_t</a> *) source;
00476 
00477     <span class="keywordflow">if</span> (echosource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.revents &amp; (G_IO_HUP | G_IO_ERR)) {
00478         <a class="code" href="mainloop__glib_8c.html#a26">source_close</a>((<a class="code" href="structsource__t.html">source_t</a> *) echosource);
00479     }
00480     <span class="keywordflow">if</span> (echosource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.revents &amp; G_IO_IN) {
00481         <a class="code" href="mainloop__glib_8c.html#a31">echo_dispatch_read</a>(echosource);
00482     }
00483     <span class="keywordflow">if</span> (echosource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.revents &amp; G_IO_OUT) {
00484         <a class="code" href="mainloop__glib_8c.html#a32">echo_dispatch_write</a>(echosource);
00485     }
00486     <span class="keywordflow">return</span> TRUE;
00487 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="mainloop_glib.c::echo_dispatch_read" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void echo_dispatch_read           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structsource__t.html">source_t</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>echosource</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
read data from echo client 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>echosource</em>&nbsp;</td><td>echo client source</td></tr>
  </table>
</dl>
If the buffer is not full, tries to do one read from the filedescriptor associated with this echo client. 
<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00498">498</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__glib_8c-source.html#l00067">echo_source_t::buf</a>, <a class="el" href="mainloop__bad_8c-source.html#l00042">BUFSIZE</a>, <a class="el" href="mainloop__glib_8c-source.html#l00084">source_t::echo</a>, <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00055">MSG_FULL</a>, <a class="el" href="mainloop__bad_8c-source.html#l00053">MSG_READ</a>, <a class="el" href="mainloop__glib_8c-source.html#l00066">echo_source_t::n</a>, <a class="el" href="mainloop__glib_8c-source.html#l00079">source_t::pollfd</a>, <a class="el" href="mainloop__glib_8c-source.html#l00064">echo_source_t::r</a>, <a class="el" href="mainloop__glib_8c-source.html#l00592">source_close()</a>, and <a class="el" href="mainloop__glib_8c-source.html#l00065">echo_source_t::w</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00471">echo_dispatch()</a>.
<p>
<pre class="fragment"><div>00499 {
00500     ssize_t         nread;
00501 
00502     <span class="keywordflow">if</span> (echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o2">n</a> == <a class="code" href="mainloop__bad_8c.html#a4">BUFSIZE</a>) {
00503         <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_FULL);
00504         <span class="keywordflow">return</span>;
00505     }
00506 
00507     <span class="keywordflow">if</span> (echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o0">r</a> &gt;= echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o1">w</a>) {
00508         nread =
00509             read(echosource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.fd,
00510                  echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o3">buf</a> + echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o0">r</a>,
00511                  BUFSIZE - echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o0">r</a>);
00512     } <span class="keywordflow">else</span> {
00513         nread =
00514             read(echosource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.fd,
00515                  echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o3">buf</a> + echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o0">r</a>,
00516                  echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o1">w</a> - echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o0">r</a>);
00517     }
00518 
00519     <span class="keywordflow">switch</span> (nread) {
00520     <span class="keywordflow">case</span> -1:
00521         <span class="keywordflow">if</span> ((errno != EINTR) &amp;&amp; (errno != EWOULDBLOCK)) {
00522             perror(<span class="stringliteral">"read()"</span>);
00523             exit(EXIT_FAILURE);
00524         }
00525         <span class="keywordflow">break</span>;
00526     <span class="keywordflow">case</span> 0:
00527         <a class="code" href="mainloop__glib_8c.html#a26">source_close</a>((<a class="code" href="structsource__t.html">source_t</a> *) echosource);
00528         <span class="keywordflow">return</span>;
00529     <span class="keywordflow">default</span>:
00530         <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_READ);
00531         echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o2">n</a> += nread;
00532         echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o0">r</a> += nread;
00533         echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o0">r</a> %= <a class="code" href="mainloop__bad_8c.html#a4">BUFSIZE</a>;
00534     }
00535 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="mainloop_glib.c::echo_dispatch_write" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void echo_dispatch_write           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structsource__t.html">source_t</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>echosource</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
write data to an echo client 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>echosource</em>&nbsp;</td><td>echo client source</td></tr>
  </table>
</dl>
If the buffer is not empty, tries to do one write to the filedescriptor associated with the echo client. 
<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00546">546</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__glib_8c-source.html#l00067">echo_source_t::buf</a>, <a class="el" href="mainloop__bad_8c-source.html#l00042">BUFSIZE</a>, <a class="el" href="mainloop__glib_8c-source.html#l00084">source_t::echo</a>, <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00056">MSG_EMPTY</a>, <a class="el" href="mainloop__bad_8c-source.html#l00054">MSG_WRITE</a>, <a class="el" href="mainloop__glib_8c-source.html#l00066">echo_source_t::n</a>, <a class="el" href="mainloop__glib_8c-source.html#l00079">source_t::pollfd</a>, <a class="el" href="mainloop__glib_8c-source.html#l00064">echo_source_t::r</a>, <a class="el" href="mainloop__glib_8c-source.html#l00592">source_close()</a>, and <a class="el" href="mainloop__glib_8c-source.html#l00065">echo_source_t::w</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00471">echo_dispatch()</a>.
<p>
<pre class="fragment"><div>00547 {
00548     ssize_t         nwrite;
00549 
00550     <span class="keywordflow">if</span> (echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o2">n</a> == 0) {
00551         <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_EMPTY);
00552         <span class="keywordflow">return</span>;
00553     }
00554 
00555     <span class="keywordflow">if</span> (echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o0">r</a> &gt; echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o1">w</a>) {
00556         nwrite =
00557             write(echosource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.fd,
00558                   echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o3">buf</a> + echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o1">w</a>,
00559                   echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o0">r</a> - echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o1">w</a>);
00560     } <span class="keywordflow">else</span> {
00561         nwrite =
00562             write(echosource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.fd,
00563                   echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o3">buf</a> + echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o1">w</a>,
00564                   BUFSIZE - echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o1">w</a>);
00565     }
00566 
00567     <span class="keywordflow">switch</span> (nwrite) {
00568     <span class="keywordflow">case</span> -1:
00569         <span class="keywordflow">if</span> (errno == EPIPE) {
00570             <a class="code" href="mainloop__glib_8c.html#a26">source_close</a>((<a class="code" href="structsource__t.html">source_t</a> *) echosource);
00571         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((errno != EINTR) &amp;&amp; (errno != EWOULDBLOCK)) {
00572             perror(<span class="stringliteral">"write()"</span>);
00573             exit(EXIT_FAILURE);
00574         }
00575         <span class="keywordflow">break</span>;
00576     <span class="keywordflow">case</span> 0:
00577         <span class="keywordflow">break</span>;
00578     <span class="keywordflow">default</span>:
00579         <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_WRITE);
00580         echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o2">n</a> -= nwrite;
00581         echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o1">w</a> += nwrite;
00582         echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o1">w</a> %= <a class="code" href="mainloop__bad_8c.html#a4">BUFSIZE</a>;
00583     }
00584 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="mainloop_glib.c::echo_prepare" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> gboolean echo_prepare           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">GSource *&nbsp;</td>
          <td class="mdname" nowrap> <em>source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>gint *&nbsp;</td>
          <td class="mdname" nowrap> <em>timeout</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Prepare GSource for polling an echo client. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>source</em>&nbsp;</td><td>GSource to prepare </td></tr>
    <tr><td></td><td valign=top><em>timeout</em>&nbsp;</td><td>maximum timeout to set for poll() (out)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>always FALSE (use poll)</dd></dl>
If the buffer is full, checking for read is turned off resp. if the buffer is empty, checking for write is turned off. 
<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00442">442</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__bad_8c-source.html#l00042">BUFSIZE</a>, <a class="el" href="mainloop__glib_8c-source.html#l00084">source_t::echo</a>, <a class="el" href="mainloop__glib_8c-source.html#l00066">echo_source_t::n</a>, and <a class="el" href="mainloop__glib_8c-source.html#l00079">source_t::pollfd</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00390">getechoclientsource()</a>.
<p>
<pre class="fragment"><div>00443 {
00444     <a class="code" href="structsource__t.html">source_t</a>       *echosource;
00445 
00446     echosource = (<a class="code" href="structsource__t.html">source_t</a> *) source;
00447 
00448     <span class="keywordflow">switch</span> (echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o2">n</a>) {
00449     <span class="keywordflow">case</span> 0:
00450         echosource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.events = G_IO_IN;
00451         <span class="keywordflow">break</span>;
00452     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a4">BUFSIZE</a>:
00453         echosource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.events = G_IO_OUT;
00454         <span class="keywordflow">break</span>;
00455     <span class="keywordflow">default</span>:
00456         echosource-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.events = G_IO_IN | G_IO_OUT;
00457     }
00458     <span class="keywordflow">return</span> FALSE;
00459 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="mainloop_glib.c::getchargenclientsource" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GSource * getchargenclientsource           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
construct GSourceFuncs for chargen client 
<p>
<dl compact><dt><b>Returns:</b></dt><dd>GSource for chargen client </dd></dl>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00414">414</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__glib_8c-source.html#l00085">source_t::chargen</a>, <a class="el" href="mainloop__glib_8c-source.html#l00633">chargen_dispatch()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00609">chargen_prepare()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00307">check()</a>, and <a class="el" href="mainloop__glib_8c-source.html#l00074">chargen_source_t::i</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00666">main()</a>.
<p>
<pre class="fragment"><div>00415 {
00416     <span class="keyword">static</span> GSourceFuncs funcs = { NULL, NULL, NULL, NULL, NULL, NULL };
00417     <a class="code" href="structsource__t.html">source_t</a>       *chargensource;
00418 
00419     <span class="comment">/* cannot reference functions in static initializer */</span>
00420     funcs.prepare = <a class="code" href="mainloop__glib_8c.html#a33">chargen_prepare</a>;
00421     funcs.check = <a class="code" href="mainloop__glib_8c.html#a25">check</a>;
00422     funcs.dispatch = <a class="code" href="mainloop__glib_8c.html#a34">chargen_dispatch</a>;
00423     funcs.finalize = NULL;
00424 
00425     chargensource = (<a class="code" href="structsource__t.html">source_t</a> *) g_source_new(&amp;funcs, <span class="keyword">sizeof</span>(<a class="code" href="structsource__t.html">source_t</a>));
00426     chargensource-&gt;<a class="code" href="structsource__t.html#o5">chargen</a>.<a class="code" href="structchargen__source__t.html#o0">i</a> = 0;
00427     <span class="keywordflow">return</span> (GSource *) chargensource;
00428 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="mainloop_glib.c::getechoclientsource" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GSource * getechoclientsource           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
construct GSourceFuncs for echo client 
<p>
<dl compact><dt><b>Returns:</b></dt><dd>GSource for echo client </dd></dl>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00390">390</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__glib_8c-source.html#l00307">check()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00084">source_t::echo</a>, <a class="el" href="mainloop__glib_8c-source.html#l00471">echo_dispatch()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00442">echo_prepare()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00066">echo_source_t::n</a>, <a class="el" href="mainloop__glib_8c-source.html#l00064">echo_source_t::r</a>, and <a class="el" href="mainloop__glib_8c-source.html#l00065">echo_source_t::w</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00666">main()</a>.
<p>
<pre class="fragment"><div>00391 {
00392     <span class="keyword">static</span> GSourceFuncs funcs = { NULL, NULL, NULL, NULL, NULL, NULL };
00393     <a class="code" href="structsource__t.html">source_t</a>       *echosource;
00394 
00395     <span class="comment">/* cannot reference functions in static initializer */</span>
00396     funcs.prepare = <a class="code" href="mainloop__glib_8c.html#a29">echo_prepare</a>;
00397     funcs.check = <a class="code" href="mainloop__glib_8c.html#a25">check</a>;
00398     funcs.dispatch = <a class="code" href="mainloop__glib_8c.html#a30">echo_dispatch</a>;
00399     funcs.finalize = NULL;
00400 
00401     echosource = (<a class="code" href="structsource__t.html">source_t</a> *) g_source_new(&amp;funcs, <span class="keyword">sizeof</span>(<a class="code" href="structsource__t.html">source_t</a>));
00402     echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o0">r</a> = 0;
00403     echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o1">w</a> = 0;
00404     echosource-&gt;<a class="code" href="structsource__t.html#o4">echo</a>.<a class="code" href="structecho__source__t.html#o2">n</a> = 0;
00405     <span class="keywordflow">return</span> (GSource *) echosource;
00406 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="mainloop_glib.c::heartbeat" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> gboolean heartbeat           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">gpointer&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>data</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
print heartbeat message 
<p>
<dl compact><dt><b>Returns:</b></dt><dd>always TRUE </dd></dl>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00281">281</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00047">MSG_HEARTBEAT</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00666">main()</a>.
<p>
<pre class="fragment"><div>00282 {
00283     <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_HEARTBEAT);
00284     <span class="keywordflow">return</span> TRUE;
00285 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="mainloop_glib.c::listensocket" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int listensocket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>port</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
return tcp socket listening on port specified 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>port</em>&nbsp;</td><td>port number in host byte order</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>file descriptor for listening socket</dd></dl>
The socket is set to be nonblocking 
<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00193">193</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00406">setnonblock()</a>.
<p>
<pre class="fragment"><div>00194 {
00195     <span class="keywordtype">int</span>             serverfd;
00196     <span class="keyword">struct </span>sockaddr_in sain;
00197     <span class="keywordtype">int</span>             one;
00198 
00199     <span class="comment">/* set up tcp socket for listening */</span>
00200     sain.sin_family = AF_INET;
00201     sain.sin_port = htons(port);
00202     sain.sin_addr.s_addr = INADDR_ANY;
00203     <span class="keywordflow">if</span> ((serverfd = socket(AF_INET, SOCK_STREAM, 0)) == -1) {
00204         perror(<span class="stringliteral">"socket(AF_INET, SOCK_STREAM, 0)"</span>);
00205         exit(EXIT_FAILURE);
00206     }
00207     one = 1;
00208     <span class="keywordflow">if</span> (setsockopt
00209         (serverfd, SOL_SOCKET, SO_REUSEADDR, &amp;one,
00210          (<span class="keywordtype">int</span>) <span class="keyword">sizeof</span>(one)) == -1) {
00211         perror(<span class="stringliteral">"setsockopt(SO_REUSEADDR)"</span>);
00212         exit(EXIT_FAILURE);
00213     }
00214     <span class="keywordflow">if</span> (bind
00215         (serverfd, (<span class="keyword">struct </span>sockaddr *) &amp;sain,
00216          <span class="keyword">sizeof</span>(<span class="keyword">struct </span>sockaddr_in)) == -1) {
00217         perror(<span class="stringliteral">"bind()"</span>);
00218         exit(EXIT_FAILURE);
00219     }
00220     <span class="keywordflow">if</span> (listen(serverfd, 5) == -1) {
00221         perror(<span class="stringliteral">"listen()"</span>);
00222         exit(EXIT_FAILURE);
00223     }
00224     <a class="code" href="mainloop__good_8c.html#a35">setnonblock</a>(serverfd);
00225 
00226     printf(<span class="stringliteral">"listening on port %d\n"</span>, port);
00227 
00228     <span class="keywordflow">return</span> serverfd;
00229 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="mainloop_glib.c::listensource" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="structsource__t.html">source_t</a> * listensource           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="mainloop__glib_8c.html#a16">getclientsourcefunc</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>getclientsource</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>port</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
construct listensource listening on port specified 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>getclientsource</em>&nbsp;</td><td>function returning clientsource for accepted connection </td></tr>
    <tr><td></td><td valign=top><em>port</em>&nbsp;</td><td>tcp port to listen on in host byte order</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>listensource_t </dd></dl>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00257">257</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__glib_8c-source.html#l00347">accept_dispatch()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00326">accept_prepare()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00307">check()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00057">listen_source_t::getclientsource</a>, <a class="el" href="mainloop__glib_8c-source.html#l00083">source_t::listen</a>, <a class="el" href="mainloop__good_8c-source.html#l00359">listensocket()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00257">listensource()</a>, and <a class="el" href="mainloop__glib_8c-source.html#l00079">source_t::pollfd</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00257">listensource()</a>, and <a class="el" href="mainloop__glib_8c-source.html#l00666">main()</a>.
<p>
<pre class="fragment"><div>00258 {
00259     <span class="keyword">static</span> GSourceFuncs listenfuncs;
00260     <a class="code" href="structsource__t.html">source_t</a>       *<a class="code" href="mainloop__glib_8c.html#a20">listensource</a>;
00261 
00262     listenfuncs.prepare = &amp;<a class="code" href="mainloop__glib_8c.html#a27">accept_prepare</a>;
00263     listenfuncs.check = &amp;<a class="code" href="mainloop__glib_8c.html#a25">check</a>;
00264     listenfuncs.dispatch = &amp;<a class="code" href="mainloop__glib_8c.html#a28">accept_dispatch</a>;
00265     listenfuncs.finalize = NULL;
00266     <a class="code" href="mainloop__glib_8c.html#a20">listensource</a> =
00267         (<a class="code" href="structsource__t.html">source_t</a> *) g_source_new(&amp;listenfuncs, <span class="keyword">sizeof</span>(<a class="code" href="structsource__t.html">source_t</a>));
00268     <a class="code" href="mainloop__glib_8c.html#a20">listensource</a>-&gt;<a class="code" href="structsource__t.html#o3">listen</a>.<a class="code" href="structlisten__source__t.html#o0">getclientsource</a> = getclientsource;
00269 
00270     <a class="code" href="mainloop__glib_8c.html#a20">listensource</a>-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.fd = <a class="code" href="mainloop__good_8c.html#a34">listensocket</a>(port);
00271     g_source_add_poll((GSource *) listensource, &amp;(<a class="code" href="mainloop__glib_8c.html#a20">listensource</a>-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>));
00272     <span class="keywordflow">return</span> <a class="code" href="mainloop__glib_8c.html#a20">listensource</a>;
00273 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="mainloop_glib.c::main" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int main           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00666">666</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__glib_8c-source.html#l00170">blocksigpipe()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00414">getchargenclientsource()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00390">getechoclientsource()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00281">heartbeat()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00036">HEARTBEAT_INTERVAL</a>, <a class="el" href="mainloop__glib_8c-source.html#l00080">source_t::id</a>, <a class="el" href="mainloop__glib_8c-source.html#l00257">listensource()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00033">PORT_CHARGEN</a>, <a class="el" href="mainloop__bad_8c-source.html#l00030">PORT_ECHO</a>, <a class="el" href="mainloop__glib_8c-source.html#l00293">slowheartbeat()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00039">SLOWHEARTBEAT_INTERVAL</a>.
<p>
<pre class="fragment"><div>00667 {
00668     GMainLoop      *mainloop;
00669     GMainContext   *context;
00670     <a class="code" href="structsource__t.html">source_t</a>       *listenecho, *listenchargen;
00671 
00672     <span class="comment">/* check glib version */</span>
00673     <span class="keywordflow">if</span> (!GLIB_CHECK_VERSION(2, 0, 0)) {
00674         fprintf(stderr, <span class="stringliteral">"glib %d.%d.%d is too old\n"</span>, GLIB_MAJOR_VERSION,
00675                 GLIB_MINOR_VERSION, GLIB_MICRO_VERSION);
00676         exit(EXIT_FAILURE);
00677     }
00678 
00679     printf(<span class="stringliteral">"example: glib main loop\n"</span>);
00680 
00681     <a class="code" href="mainloop__glib_8c.html#a35">blocksigpipe</a>();
00682 
00683     <span class="comment">/* create main loop */</span>
00684     context = g_main_context_default();
00685     mainloop = g_main_loop_new(context, FALSE);
00686 
00687     <span class="comment">/* create echo service */</span>
00688     listenecho = <a class="code" href="mainloop__glib_8c.html#a20">listensource</a>(getechoclientsource, PORT_ECHO);
00689     listenecho-&gt;<a class="code" href="structsource__t.html#o2">id</a> = g_source_attach((GSource *) listenecho, context);
00690 
00691     <span class="comment">/* create chargen service */</span>
00692     listenchargen = <a class="code" href="mainloop__glib_8c.html#a20">listensource</a>(getchargenclientsource, PORT_CHARGEN);
00693     listenchargen-&gt;<a class="code" href="structsource__t.html#o2">id</a> =
00694         g_source_attach((GSource *) listenchargen, context);
00695 
00696     <span class="comment">/* install heartbeat */</span>
00697     (<span class="keywordtype">void</span>) g_timeout_add(1000 * HEARTBEAT_INTERVAL, &amp;heartbeat, NULL);
00698     (<span class="keywordtype">void</span>) g_timeout_add(1000 * SLOWHEARTBEAT_INTERVAL, &amp;slowheartbeat, NULL);
00699     printf(<span class="stringliteral">"heartbeat every %d seconds\n"</span>, HEARTBEAT_INTERVAL);
00700     printf(<span class="stringliteral">"slow heartbeat every %d seconds\n"</span>, SLOWHEARTBEAT_INTERVAL);
00701 
00702     <span class="comment">/* run the main loop */</span>
00703     g_main_loop_run(mainloop);
00704     <span class="comment">/* notreached */</span>
00705 
00706     g_main_loop_unref(mainloop);
00707     exit(EXIT_SUCCESS);
00708 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="mainloop_glib.c::message" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void message           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
print message describing current activity 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>msg</em>&nbsp;</td><td>id of message to print (MSG_XYZ) </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00126">126</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__bad_8c-source.html#l00050">MSG_ACCEPT</a>, <a class="el" href="mainloop__bad_8c-source.html#l00052">MSG_CLOSE</a>, <a class="el" href="mainloop__bad_8c-source.html#l00056">MSG_EMPTY</a>, <a class="el" href="mainloop__bad_8c-source.html#l00055">MSG_FULL</a>, <a class="el" href="mainloop__bad_8c-source.html#l00047">MSG_HEARTBEAT</a>, <a class="el" href="mainloop__bad_8c-source.html#l00049">MSG_MAINLOOP</a>, <a class="el" href="mainloop__bad_8c-source.html#l00053">MSG_READ</a>, <a class="el" href="mainloop__bad_8c-source.html#l00048">MSG_SLOWHEARTBEAT</a>, <a class="el" href="mainloop__bad_8c-source.html#l00051">MSG_TOOMANY</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00054">MSG_WRITE</a>.
<p>
<pre class="fragment"><div>00127 {
00128     <span class="keywordflow">switch</span> (msg) {
00129     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a6">MSG_HEARTBEAT</a>:
00130         printf(<span class="stringliteral">"H"</span>);
00131         <span class="keywordflow">break</span>;
00132     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a7">MSG_SLOWHEARTBEAT</a>:
00133         printf(<span class="stringliteral">"S"</span>);
00134         <span class="keywordflow">break</span>;
00135     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a8">MSG_MAINLOOP</a>:
00136         printf(<span class="stringliteral">"M"</span>);
00137         <span class="keywordflow">break</span>;
00138     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a9">MSG_ACCEPT</a>:
00139         printf(<span class="stringliteral">"A"</span>);
00140         <span class="keywordflow">break</span>;
00141     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a10">MSG_TOOMANY</a>:
00142         printf(<span class="stringliteral">"T"</span>);
00143         <span class="keywordflow">break</span>;
00144     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a11">MSG_CLOSE</a>:
00145         printf(<span class="stringliteral">"C"</span>);
00146         <span class="keywordflow">break</span>;
00147     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a12">MSG_READ</a>:
00148         printf(<span class="stringliteral">"R"</span>);
00149         <span class="keywordflow">break</span>;
00150     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a13">MSG_WRITE</a>:
00151         printf(<span class="stringliteral">"W"</span>);
00152         <span class="keywordflow">break</span>;
00153     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a14">MSG_FULL</a>:
00154         printf(<span class="stringliteral">"F"</span>);
00155         <span class="keywordflow">break</span>;
00156     <span class="keywordflow">case</span> <a class="code" href="mainloop__bad_8c.html#a15">MSG_EMPTY</a>:
00157         printf(<span class="stringliteral">"E"</span>);
00158         <span class="keywordflow">break</span>;
00159     }
00160     fflush(stdout);
00161 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="mainloop_glib.c::setnonblock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void setnonblock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
set a file descriptor to be nonblocking 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>fd</em>&nbsp;</td><td>file descriptor</td></tr>
  </table>
</dl>
Non-Blocking works only for Sockets, Pipes and slow devices, it has no effect when used with regular files 
<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00240">240</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
<pre class="fragment"><div>00241 {
00242     <span class="keywordtype">int</span>             flag;
00243 
00244     flag = fcntl(fd, F_GETFL);
00245     fcntl(fd, F_GETFL, flag | O_NONBLOCK);
00246 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="mainloop_glib.c::slowheartbeat" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> gboolean slowheartbeat           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">gpointer&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>data</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
print "slowheartbeat" message 
<p>
<dl compact><dt><b>Returns:</b></dt><dd>always TRUE </dd></dl>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00293">293</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, and <a class="el" href="mainloop__bad_8c-source.html#l00048">MSG_SLOWHEARTBEAT</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00666">main()</a>.
<p>
<pre class="fragment"><div>00294 {
00295     <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_SLOWHEARTBEAT);
00296     <span class="keywordflow">return</span> TRUE;
00297 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="mainloop_glib.c::source_close" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void source_close           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structsource__t.html">source_t</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>source</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
close a source and dispose of source 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>source</em>&nbsp;</td><td>source to close/dispose </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00592">592</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
References <a class="el" href="mainloop__glib_8c-source.html#l00080">source_t::id</a>, <a class="el" href="mainloop__good_8c-source.html#l00170">message()</a>, <a class="el" href="mainloop__bad_8c-source.html#l00052">MSG_CLOSE</a>, and <a class="el" href="mainloop__glib_8c-source.html#l00079">source_t::pollfd</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00633">chargen_dispatch()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00471">echo_dispatch()</a>, <a class="el" href="mainloop__glib_8c-source.html#l00498">echo_dispatch_read()</a>, and <a class="el" href="mainloop__glib_8c-source.html#l00546">echo_dispatch_write()</a>.
<p>
<pre class="fragment"><div>00593 {
00594     <a class="code" href="mainloop__good_8c.html#a26">message</a>(MSG_CLOSE);
00595     (<span class="keywordtype">void</span>) g_source_remove(source-&gt;<a class="code" href="structsource__t.html#o2">id</a>);
00596     close(source-&gt;<a class="code" href="structsource__t.html#o1">pollfd</a>.fd);
00597     g_source_unref((GSource *) source);
00598 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a15" doxytag="mainloop_glib.c::chargen_buf" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char <a class="el" href="mainloop__good_8c.html#a19">chargen_buf</a>[] = "0123456789abcdefghijklmnopqrstuv"<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
characters to return in chargen service 
<p>

<p>
Definition at line <a class="el" href="mainloop__glib_8c-source.html#l00049">49</a> of file <a class="el" href="mainloop__glib_8c-source.html">mainloop_glib.c</a>.
<p>
Referenced by <a class="el" href="mainloop__glib_8c-source.html#l00633">chargen_dispatch()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jul 19 16:02:07 2004 for mainloop by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
